use crate::errors::BotError;
use crate::settings::{BotState, REDIS_USER_CALCS_PREFIX, REDIS_USER_PREFIX};
use redis::AsyncCommands;
use serde::{Deserialize, Serialize};
use std::{collections::HashSet, sync::Arc};
use teloxide::{prelude::*, types::Message};
use uuid::Uuid;



pub async fn has_too_many_calcs(state: &Arc<BotState>, user_id: i64) -> Result<bool, BotError> {
    let mut conn = state.redis_client.get_async_connection().await?;
    let count = UsersCalcs::load(&mut conn, user_id)
        .await?
        .map(|c| c.calcs.len())
        .unwrap_or_default();
    Ok(count >= state.config.max_active_calcs)
}


